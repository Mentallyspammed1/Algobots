{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/genkit.ts"],"sourcesContent":["import {genkit} from 'genkit';\nimport {googleAI} from '@genkit-ai/googleai';\n\nexport const ai = genkit({\n  plugins: [googleAI()],\n  model: 'googleai/gemini-2.5-flash',\n  enableDevUI: true,\n});\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAGO,MAAM,KAAK,OAAO;IACvB,SAAS;QAAC;KAAW;IACrB,OAAO;IACP,aAAa;AACf","debugId":null}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/bybit-api.ts"],"sourcesContent":["\nimport { z } from 'zod';\n\n// #region Zod Schemas and Types\n/**\n * Zod schema for Bybit ticker information.\n */\nexport const TickerInfoSchema = z.object({\n  lastPrice: z.string(),\n  highPrice24h: z.string(),\n  lowPrice24h: z.string(),\n  turnover24h: z.string(), // Volume in quote currency (USDT)\n  volume24h: z.string(), // Volume in base currency (e.g., BTC)\n  price24hPcnt: z.string(), // 24h price change percentage\n});\nexport type TickerInfo = z.infer<typeof TickerInfoSchema>;\n\n/**\n * Zod schema for a single entry in the order book (a price and size pair).\n */\nexport const OrderBookEntrySchema = z.tuple([z.string(), z.string()]); // [price, size]\nexport type OrderBookEntry = z.infer<typeof OrderBookEntrySchema>;\n\n/**\n * Zod schema for the entire order book.\n */\nexport const OrderBookSchema = z.object({\n  bids: z.array(OrderBookEntrySchema),\n  asks: z.array(OrderBookEntrySchema),\n  ts: z.string(), // Orderbook timestamp\n});\nexport type OrderBook = z.infer<typeof OrderBookSchema>;\n\n/**\n * Zod schema for a single recent trade.\n */\nexport const RecentTradeSchema = z.object({\n  execId: z.string(),\n  execTime: z.union([z.string(), z.number()]),\n  price: z.string(),\n  qty: z.string(),\n  side: z.enum(['Buy', 'Sell']),\n  isBlockTrade: z.boolean().optional(), // Whether it's a block trade\n});\nexport type RecentTrade = z.infer<typeof RecentTradeSchema>;\n\n/**\n * Zod schema for a single Kline (candlestick) entry.\n */\nexport const KlineEntrySchema = z.tuple([\n  z.string(), // Start time\n  z.string(), // Open\n  z.string(), // High\n  z.string(), // Low\n  z.string(), // Close\n  z.string(), // Volume\n  z.string(), // Turnover\n  z.string().optional() // Optional: Confirm flag (1 if the kline is closed)\n]);\nexport type KlineEntry = z.infer<typeof KlineEntrySchema>;\n\n// #endregion\n\n// #region Constants\nconst BYBIT_API_URL = 'https://api.bybit.com';\nexport const BYBIT_WEBSOCKET_URL = 'wss://stream.bybit.com/v5/public/spot';\nexport const DEFAULT_REQUEST_TIMEOUT = 10000; // 10 seconds\nconst MAX_RETRIES = 3;\nconst RETRY_DELAY_MS = 1000;\n// #endregion\n\n/**\n * The standard response structure from the Bybit API.\n */\ninterface ApiResponse<T> {\n  retCode: number;\n  retMsg: string;\n  result: T;\n  time: number;\n}\n\n/**\n * An enhanced fetch function for interacting with the Bybit API.\n * Includes retry logic, request timeout, and standardized error handling.\n *\n * @param endpoint - The API endpoint path (e.g., '/v5/market/tickers').\n * @param params - A record of query parameters to include in the request.\n * @param options - Standard RequestInit options to pass to fetch.\n * @returns A promise that resolves to the 'result' field of the API response, or null if an error occurs.\n */\nasync function fetchFromBybit<T>(\n  endpoint: string, \n  params: Record<string, string> = {}, \n  options: RequestInit = {}\n): Promise<T | null> {\n  const url = new URL(endpoint, BYBIT_API_URL);\n  url.search = new URLSearchParams(params).toString();\n  \n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), DEFAULT_REQUEST_TIMEOUT);\n  \n  const fetchOptions: RequestInit = {\n    cache: 'no-store',\n    signal: options.signal || controller.signal, // Use provided signal or internal timeout signal\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    ...options\n  };\n\n  let retryCount = 0;\n  \n  while (retryCount <= MAX_RETRIES) {\n    try {\n      const response = await fetch(url.toString(), fetchOptions);\n      clearTimeout(timeoutId); // Clear timeout once response is received\n      \n      if (!response.ok) {\n        throw new Error(`Bybit API error: ${response.status} ${response.statusText}`);\n      }\n      \n      const data: ApiResponse<T> = await response.json();\n      \n      if (data.retCode !== 0) {\n        throw new Error(`Bybit API error: ${data.retMsg} (Code: ${data.retCode})`);\n      }\n      \n      return data.result;\n    } catch (error) {\n      clearTimeout(timeoutId);\n      \n      // Don't retry on abort errors or if we've reached max retries\n      if (error instanceof Error && error.name === 'AbortError') {\n        console.error(`Request to ${endpoint} timed out or was aborted`);\n        return null;\n      }\n      \n      if (retryCount === MAX_RETRIES) {\n        console.error(`Failed to fetch from Bybit endpoint ${endpoint} after ${MAX_RETRIES} retries:`, error);\n        return null;\n      }\n      \n      // Exponential backoff\n      const delay = RETRY_DELAY_MS * Math.pow(2, retryCount);\n      console.warn(`Retry ${retryCount + 1}/${MAX_RETRIES} for ${endpoint} in ${delay}ms`);\n      \n      await new Promise(resolve => setTimeout(resolve, delay));\n      retryCount++;\n    }\n  }\n  \n  return null;\n}\n\n/**\n * Fetches ticker information for a specific symbol.\n *\n * @param symbol - The trading symbol (e.g., 'BTCUSDT').\n * @returns A promise resolving to a validated TickerInfo object or null.\n */\nexport async function getTicker(symbol: string): Promise<TickerInfo | null> {\n  try {\n    const result = await fetchFromBybit<any>('/v5/market/tickers', { \n      category: 'spot', \n      symbol \n    });\n    \n    if (!result || !result.list || result.list.length === 0) {\n      console.warn(`No ticker data found for symbol: ${symbol}`);\n      return null;\n    }\n    \n    // Extract and validate the ticker data\n    const ticker = result.list[0];\n    const validation = TickerInfoSchema.safeParse(ticker);\n\n    if(!validation.success) {\n        console.warn(`Invalid ticker data received for ${symbol}:`, validation.error);\n        return null;\n    }\n    \n    return validation.data;\n\n  } catch (error) {\n    console.error(`Error fetching ticker for ${symbol}:`, error);\n    return null;\n  }\n}\n\n/**\n * Fetches the order book for a specific symbol.\n *\n * @param symbol - The trading symbol.\n * @param limit - The number of price levels to fetch (depth).\n * @returns A promise resolving to a validated OrderBook object or null.\n */\nexport async function getOrderBook(symbol: string, limit: number = 20): Promise<OrderBook | null> {\n  try {\n    const result = await fetchFromBybit<any>('/v5/market/orderbook', { \n      category: 'spot', \n      symbol, \n      limit: limit.toString() \n    });\n    \n    if (!result) {\n      console.warn(`No orderbook data found for symbol: ${symbol}`);\n      return null;\n    }\n    \n    const validation = OrderBookSchema.safeParse({\n        bids: result.b,\n        asks: result.a,\n        ts: result.ts?.toString() || Date.now().toString()\n    });\n\n    if(!validation.success) {\n        console.warn(`Invalid orderbook data for ${symbol}:`, validation.error);\n        return null;\n    }\n    \n    return validation.data;\n\n  } catch (error) {\n    console.error(`Error fetching orderbook for ${symbol}:`, error);\n    return null;\n  }\n}\n\n/**\n * Fetches the most recent public trades for a symbol.\n *\n * @param symbol - The trading symbol.\n * @param limit - The maximum number of trades to fetch.\n * @param options - Standard RequestInit options to pass to fetch.\n * @returns A promise resolving to an array of validated RecentTrade objects.\n */\nexport async function getRecentTrades(\n  symbol: string, \n  limit: number = 30, \n  options: RequestInit = {}\n): Promise<RecentTrade[]> {\n  try {\n    const result = await fetchFromBybit<any>(\n      '/v5/market/recent-trade', \n      { \n        category: 'spot', \n        symbol, \n        limit: limit.toString() \n      }, \n      options\n    );\n    \n    if (!result || !result.list || !Array.isArray(result.list)) {\n      return [];\n    }\n    \n    // Filter and validate trade data\n    const validatedTrades: RecentTrade[] = [];\n    for(const trade of result.list) {\n        const mappedTrade = {\n            execId: trade.i,\n            execTime: trade.T,\n            price: trade.p,\n            qty: trade.v,\n            side: trade.S,\n            isBlockTrade: trade.m,\n        };\n        const validation = RecentTradeSchema.safeParse(mappedTrade);\n        if(validation.success) {\n            validatedTrades.push(validation.data);\n        }\n    }\n    return validatedTrades;\n\n  } catch (error) {\n    if (!(error instanceof Error && error.name === 'AbortError')) {\n      console.error(`Error fetching recent trades for ${symbol}:`, error);\n    }\n    return [];\n  }\n}\n\n/**\n * Fetches Kline (candlestick) data for a symbol and interval.\n *\n * @param symbol - The trading symbol.\n * @param interval - The user-friendly interval string (e.g., '1h', '1d').\n * @param limit - The number of candlesticks to fetch.\n * @returns A promise resolving to an array of validated KlineEntry tuples or null.\n */\nexport async function getKline(\n  symbol: string, \n  interval: string, \n  limit: number = 100\n): Promise<KlineEntry[] | null> {\n  try {\n    // Map user-friendly intervals to Bybit's required format\n    const intervalMap: Record<string, string> = {\n      '1m': '1',\n      '5m': '5',\n      '15m': '15',\n      '30m': '30',\n      '1h': '60',\n      '2h': '120',\n      '4h': '240',\n      '6h': '360',\n      '12h': '720',\n      '1d': 'D',\n      '1w': 'W',\n      '1M': 'M',\n    };\n    \n    const bybitInterval = intervalMap[interval] || interval;\n    \n    const result = await fetchFromBybit<any>('/v5/market/kline', { \n      category: 'spot', \n      symbol, \n      interval: bybitInterval, \n      limit: limit.toString() \n    });\n    \n    if (!result || !result.list || !Array.isArray(result.list)) {\n      console.warn(`No kline data found for symbol: ${symbol} with interval: ${interval}`);\n      return null;\n    }\n    \n    const validation = z.array(KlineEntrySchema).safeParse(result.list);\n    if (!validation.success) {\n        console.warn(`Invalid kline data for ${symbol} with interval ${interval}:`, validation.error);\n        return null;\n    }\n\n    return validation.data;\n\n  } catch (error) {\n    console.error(`Error fetching kline data for ${symbol} with interval ${interval}:`, error);\n    return null;\n  }\n}\n\n/**\n * Fetches ticker information for multiple symbols concurrently.\n *\n * @param symbols - An array of trading symbols.\n * @returns A promise resolving to a record mapping each symbol to its TickerInfo.\n */\nexport async function getTickers(symbols: string[]): Promise<Record<string, TickerInfo>> {\n  const results: Record<string, TickerInfo> = {};\n  \n  // Use Promise.allSettled to handle partial failures gracefully\n  const promises = symbols.map(async (symbol) => {\n    const ticker = await getTicker(symbol);\n    return { symbol, ticker };\n  });\n  \n  const settledResults = await Promise.allSettled(promises);\n  \n  settledResults.forEach((result) => {\n    if (result.status === 'fulfilled' && result.value.ticker) {\n      const { symbol, ticker } = result.value;\n      results[symbol] = ticker;\n    }\n  });\n  \n  return results;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAOO,MAAM,mBAAmB,EAAE,MAAM,CAAC;IACvC,WAAW,EAAE,MAAM;IACnB,cAAc,EAAE,MAAM;IACtB,aAAa,EAAE,MAAM;IACrB,aAAa,EAAE,MAAM;IACrB,WAAW,EAAE,MAAM;IACnB,cAAc,EAAE,MAAM;AACxB;AAMO,MAAM,uBAAuB,EAAE,KAAK,CAAC;IAAC,EAAE,MAAM;IAAI,EAAE,MAAM;CAAG,GAAG,gBAAgB;AAMhF,MAAM,kBAAkB,EAAE,MAAM,CAAC;IACtC,MAAM,EAAE,KAAK,CAAC;IACd,MAAM,EAAE,KAAK,CAAC;IACd,IAAI,EAAE,MAAM;AACd;AAMO,MAAM,oBAAoB,EAAE,MAAM,CAAC;IACxC,QAAQ,EAAE,MAAM;IAChB,UAAU,EAAE,KAAK,CAAC;QAAC,EAAE,MAAM;QAAI,EAAE,MAAM;KAAG;IAC1C,OAAO,EAAE,MAAM;IACf,KAAK,EAAE,MAAM;IACb,MAAM,EAAE,IAAI,CAAC;QAAC;QAAO;KAAO;IAC5B,cAAc,EAAE,OAAO,GAAG,QAAQ;AACpC;AAMO,MAAM,mBAAmB,EAAE,KAAK,CAAC;IACtC,EAAE,MAAM;IACR,EAAE,MAAM;IACR,EAAE,MAAM;IACR,EAAE,MAAM;IACR,EAAE,MAAM;IACR,EAAE,MAAM;IACR,EAAE,MAAM;IACR,EAAE,MAAM,GAAG,QAAQ,GAAG,oDAAoD;CAC3E;AAGD,aAAa;AAEb,oBAAoB;AACpB,MAAM,gBAAgB;AACf,MAAM,sBAAsB;AAC5B,MAAM,0BAA0B,OAAO,aAAa;AAC3D,MAAM,cAAc;AACpB,MAAM,iBAAiB;AAavB;;;;;;;;CAQC,GACD,eAAe,eACb,QAAgB,EAChB,SAAiC,CAAC,CAAC,EACnC,UAAuB,CAAC,CAAC;IAEzB,MAAM,MAAM,IAAI,IAAI,UAAU;IAC9B,IAAI,MAAM,GAAG,IAAI,gBAAgB,QAAQ,QAAQ;IAEjD,MAAM,aAAa,IAAI;IACvB,MAAM,YAAY,WAAW,IAAM,WAAW,KAAK,IAAI;IAEvD,MAAM,eAA4B;QAChC,OAAO;QACP,QAAQ,QAAQ,MAAM,IAAI,WAAW,MAAM;QAC3C,SAAS;YACP,gBAAgB;QAClB;QACA,GAAG,OAAO;IACZ;IAEA,IAAI,aAAa;IAEjB,MAAO,cAAc,YAAa;QAChC,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,IAAI,QAAQ,IAAI;YAC7C,aAAa,YAAY,0CAA0C;YAEnE,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,SAAS,UAAU,EAAE;YAC9E;YAEA,MAAM,OAAuB,MAAM,SAAS,IAAI;YAEhD,IAAI,KAAK,OAAO,KAAK,GAAG;gBACtB,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,KAAK,MAAM,CAAC,QAAQ,EAAE,KAAK,OAAO,CAAC,CAAC,CAAC;YAC3E;YAEA,OAAO,KAAK,MAAM;QACpB,EAAE,OAAO,OAAO;YACd,aAAa;YAEb,8DAA8D;YAC9D,IAAI,iBAAiB,SAAS,MAAM,IAAI,KAAK,cAAc;gBACzD,QAAQ,KAAK,CAAC,CAAC,WAAW,EAAE,SAAS,yBAAyB,CAAC;gBAC/D,OAAO;YACT;YAEA,IAAI,eAAe,aAAa;gBAC9B,QAAQ,KAAK,CAAC,CAAC,oCAAoC,EAAE,SAAS,OAAO,EAAE,YAAY,SAAS,CAAC,EAAE;gBAC/F,OAAO;YACT;YAEA,sBAAsB;YACtB,MAAM,QAAQ,iBAAiB,KAAK,GAAG,CAAC,GAAG;YAC3C,QAAQ,IAAI,CAAC,CAAC,MAAM,EAAE,aAAa,EAAE,CAAC,EAAE,YAAY,KAAK,EAAE,SAAS,IAAI,EAAE,MAAM,EAAE,CAAC;YAEnF,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;YACjD;QACF;IACF;IAEA,OAAO;AACT;AAQO,eAAe,UAAU,MAAc;IAC5C,IAAI;QACF,MAAM,SAAS,MAAM,eAAoB,sBAAsB;YAC7D,UAAU;YACV;QACF;QAEA,IAAI,CAAC,UAAU,CAAC,OAAO,IAAI,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;YACvD,QAAQ,IAAI,CAAC,CAAC,iCAAiC,EAAE,QAAQ;YACzD,OAAO;QACT;QAEA,uCAAuC;QACvC,MAAM,SAAS,OAAO,IAAI,CAAC,EAAE;QAC7B,MAAM,aAAa,iBAAiB,SAAS,CAAC;QAE9C,IAAG,CAAC,WAAW,OAAO,EAAE;YACpB,QAAQ,IAAI,CAAC,CAAC,iCAAiC,EAAE,OAAO,CAAC,CAAC,EAAE,WAAW,KAAK;YAC5E,OAAO;QACX;QAEA,OAAO,WAAW,IAAI;IAExB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,0BAA0B,EAAE,OAAO,CAAC,CAAC,EAAE;QACtD,OAAO;IACT;AACF;AASO,eAAe,aAAa,MAAc,EAAE,QAAgB,EAAE;IACnE,IAAI;QACF,MAAM,SAAS,MAAM,eAAoB,wBAAwB;YAC/D,UAAU;YACV;YACA,OAAO,MAAM,QAAQ;QACvB;QAEA,IAAI,CAAC,QAAQ;YACX,QAAQ,IAAI,CAAC,CAAC,oCAAoC,EAAE,QAAQ;YAC5D,OAAO;QACT;QAEA,MAAM,aAAa,gBAAgB,SAAS,CAAC;YACzC,MAAM,OAAO,CAAC;YACd,MAAM,OAAO,CAAC;YACd,IAAI,OAAO,EAAE,EAAE,cAAc,KAAK,GAAG,GAAG,QAAQ;QACpD;QAEA,IAAG,CAAC,WAAW,OAAO,EAAE;YACpB,QAAQ,IAAI,CAAC,CAAC,2BAA2B,EAAE,OAAO,CAAC,CAAC,EAAE,WAAW,KAAK;YACtE,OAAO;QACX;QAEA,OAAO,WAAW,IAAI;IAExB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,6BAA6B,EAAE,OAAO,CAAC,CAAC,EAAE;QACzD,OAAO;IACT;AACF;AAUO,eAAe,gBACpB,MAAc,EACd,QAAgB,EAAE,EAClB,UAAuB,CAAC,CAAC;IAEzB,IAAI;QACF,MAAM,SAAS,MAAM,eACnB,2BACA;YACE,UAAU;YACV;YACA,OAAO,MAAM,QAAQ;QACvB,GACA;QAGF,IAAI,CAAC,UAAU,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM,OAAO,CAAC,OAAO,IAAI,GAAG;YAC1D,OAAO,EAAE;QACX;QAEA,iCAAiC;QACjC,MAAM,kBAAiC,EAAE;QACzC,KAAI,MAAM,SAAS,OAAO,IAAI,CAAE;YAC5B,MAAM,cAAc;gBAChB,QAAQ,MAAM,CAAC;gBACf,UAAU,MAAM,CAAC;gBACjB,OAAO,MAAM,CAAC;gBACd,KAAK,MAAM,CAAC;gBACZ,MAAM,MAAM,CAAC;gBACb,cAAc,MAAM,CAAC;YACzB;YACA,MAAM,aAAa,kBAAkB,SAAS,CAAC;YAC/C,IAAG,WAAW,OAAO,EAAE;gBACnB,gBAAgB,IAAI,CAAC,WAAW,IAAI;YACxC;QACJ;QACA,OAAO;IAET,EAAE,OAAO,OAAO;QACd,IAAI,CAAC,CAAC,iBAAiB,SAAS,MAAM,IAAI,KAAK,YAAY,GAAG;YAC5D,QAAQ,KAAK,CAAC,CAAC,iCAAiC,EAAE,OAAO,CAAC,CAAC,EAAE;QAC/D;QACA,OAAO,EAAE;IACX;AACF;AAUO,eAAe,SACpB,MAAc,EACd,QAAgB,EAChB,QAAgB,GAAG;IAEnB,IAAI;QACF,yDAAyD;QACzD,MAAM,cAAsC;YAC1C,MAAM;YACN,MAAM;YACN,OAAO;YACP,OAAO;YACP,MAAM;YACN,MAAM;YACN,MAAM;YACN,MAAM;YACN,OAAO;YACP,MAAM;YACN,MAAM;YACN,MAAM;QACR;QAEA,MAAM,gBAAgB,WAAW,CAAC,SAAS,IAAI;QAE/C,MAAM,SAAS,MAAM,eAAoB,oBAAoB;YAC3D,UAAU;YACV;YACA,UAAU;YACV,OAAO,MAAM,QAAQ;QACvB;QAEA,IAAI,CAAC,UAAU,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM,OAAO,CAAC,OAAO,IAAI,GAAG;YAC1D,QAAQ,IAAI,CAAC,CAAC,gCAAgC,EAAE,OAAO,gBAAgB,EAAE,UAAU;YACnF,OAAO;QACT;QAEA,MAAM,aAAa,EAAE,KAAK,CAAC,kBAAkB,SAAS,CAAC,OAAO,IAAI;QAClE,IAAI,CAAC,WAAW,OAAO,EAAE;YACrB,QAAQ,IAAI,CAAC,CAAC,uBAAuB,EAAE,OAAO,eAAe,EAAE,SAAS,CAAC,CAAC,EAAE,WAAW,KAAK;YAC5F,OAAO;QACX;QAEA,OAAO,WAAW,IAAI;IAExB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,8BAA8B,EAAE,OAAO,eAAe,EAAE,SAAS,CAAC,CAAC,EAAE;QACpF,OAAO;IACT;AACF;AAQO,eAAe,WAAW,OAAiB;IAChD,MAAM,UAAsC,CAAC;IAE7C,+DAA+D;IAC/D,MAAM,WAAW,QAAQ,GAAG,CAAC,OAAO;QAClC,MAAM,SAAS,MAAM,UAAU;QAC/B,OAAO;YAAE;YAAQ;QAAO;IAC1B;IAEA,MAAM,iBAAiB,MAAM,QAAQ,UAAU,CAAC;IAEhD,eAAe,OAAO,CAAC,CAAC;QACtB,IAAI,OAAO,MAAM,KAAK,eAAe,OAAO,KAAK,CAAC,MAAM,EAAE;YACxD,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,OAAO,KAAK;YACvC,OAAO,CAAC,OAAO,GAAG;QACpB;IACF;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 304, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/indicators.ts"],"sourcesContent":["import { z } from 'zod';\nimport * as ti from 'technicalindicators';\n\n// #region Indicator Settings Schemas\nexport const IndicatorSettingsSchema = z.object({\n    rsi: z.object({ period: z.number().default(14) }),\n    macd: z.object({\n        fastPeriod: z.number().default(12),\n        slowPeriod: z.number().default(26),\n        signalPeriod: z.number().default(9),\n    }),\n    bollingerBands: z.object({\n        period: z.number().default(20),\n        stdDev: z.number().default(2),\n    }),\n    stochastic: z.object({\n        period: z.number().default(14),\n        signalPeriod: z.number().default(3),\n    }),\n    atr: z.object({ period: z.number().default(14) }),\n    williamsR: z.object({ period: z.number().default(14) }),\n    cci: z.object({ period: z.number().default(20) }),\n    roc: z.object({ period: z.number().default(14) }),\n    mfi: z.object({ period: z.number().default(14) }),\n    awesomeOscillator: z.object({\n        fastPeriod: z.number().default(5),\n        slowPeriod: z.number().default(34),\n    }),\n    ichimokuCloud: z.object({\n        conversionPeriod: z.number().default(9),\n        basePeriod: z.number().default(26),\n        spanPeriod: z.number().default(52),\n        displacement: z.number().default(26),\n    }),\n    sma: z.object({ period: z.number().default(20) }),\n    supertrend: z.object({\n        period: z.number().default(10),\n        multiplier: z.number().default(3),\n    }),\n});\n// #endregion\n\n// #region Result Schemas\nconst RsiResultSchema = z.number().nullable();\nconst MacdResultSchema = z.object({ macd: z.number(), signal: z.number(), histogram: z.number() }).nullable();\nconst BollingerBandsResultSchema = z.object({ upper: z.number(), middle: z.number(), lower: z.number() }).nullable();\nconst StochasticResultSchema = z.object({ k: z.number(), d: z.number() }).nullable();\nconst AtrResultSchema = z.number().nullable();\nconst WilliamsRResultSchema = z.number().nullable();\nconst CciResultSchema = z.number().nullable();\nconst RocResultSchema = z.number().nullable();\nconst MfiResultSchema = z.number().nullable();\nconst AwesomeOscillatorResultSchema = z.number().nullable();\nconst IchimokuCloudResultSchema = z.object({ conversion: z.number(), base: z.number(), spanA: z.number(), spanB: z.number() }).nullable();\nconst SmaResultSchema = z.number().nullable();\nconst SupertrendResultSchema = z.any().nullable(); \n// #endregion\n\nexport const IndicatorDataSchema = z.object({\n    rsi: RsiResultSchema,\n    macd: MacdResultSchema,\n    bollingerBands: BollingerBandsResultSchema,\n    stochastic: StochasticResultSchema,\n    atr: AtrResultSchema,\n    williamsR: WilliamsRResultSchema,\n    cci: CciResultSchema,\n    roc: RocResultSchema,\n    mfi: MfiResultSchema,\n    awesomeOscillator: AwesomeOscillatorResultSchema,\n    ichimokuCloud: IchimokuCloudResultSchema,\n    sma: SmaResultSchema,\n    supertrend: SupertrendResultSchema,\n});\n\nexport type IndicatorSettings = z.infer<typeof IndicatorSettingsSchema>;\nexport type IndicatorData = z.infer<typeof IndicatorDataSchema>;\n\nexport const defaultIndicatorSettings: IndicatorSettings = IndicatorSettingsSchema.parse({});\n\n/**\n * Calculates all technical indicators.\n */\nexport function calculateIndicators(\n  closePrices: number[],\n  highPrices: number[],\n  lowPrices: number[],\n  volumes: number[],\n  settings: IndicatorSettings\n): IndicatorData {\n    const input = {\n        high: highPrices,\n        low: lowPrices,\n        close: closePrices,\n        volume: volumes,\n        period: 0, // Placeholder\n    };\n\n    const getLast = (arr: number[]) => arr && arr.length > 0 ? arr[arr.length - 1] : null;\n    const getLastObj = <T>(arr: T[]) => arr && arr.length > 0 ? arr[arr.length - 1] : null;\n\n    const rsi = getLast(ti.RSI.calculate({ ...input, period: settings.rsi.period, values: closePrices }));\n    const macd = getLastObj(ti.MACD.calculate({ ...input, ...settings.macd, values: closePrices }));\n    const bollingerBands = getLastObj(ti.BollingerBands.calculate({ ...input, ...settings.bollingerBands, values: closePrices }));\n    const stochastic = getLastObj(ti.Stochastic.calculate({ ...input, ...settings.stochastic }));\n    const atr = getLast(ti.ATR.calculate({ ...input, period: settings.atr.period }));\n    const williamsR = getLast(ti.WilliamsR.calculate({ ...input, period: settings.williamsR.period }));\n    const cci = getLast(ti.CCI.calculate({ ...input, period: settings.cci.period }));\n    const roc = getLast(ti.ROC.calculate({ ...input, period: settings.roc.period, values: closePrices }));\n    const mfi = getLast(ti.MFI.calculate({ ...input, period: settings.mfi.period }));\n    const awesomeOscillator = getLast(ti.AwesomeOscillator.calculate({ ...input, ...settings.awesomeOscillator }));\n    const ichimokuCloud = getLastObj(ti.IchimokuCloud.calculate({ ...input, ...settings.ichimokuCloud }));\n    const sma = getLast(ti.SMA.calculate({ ...input, period: settings.sma.period, values: closePrices }));\n    const supertrend = getLastObj(ti.Supertrend.calculate({ ...input, ...settings.supertrend }));\n\n    return {\n        rsi,\n        macd,\n        bollingerBands,\n        stochastic,\n        atr,\n        williamsR,\n        cci,\n        roc,\n        mfi,\n        awesomeOscillator,\n        ichimokuCloud,\n        sma,\n        supertrend,\n    };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 508, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/flows/generate-trading-signal.ts"],"sourcesContent":["'use server';\n/**\n * @fileOverview An AI agent that generates trading signals and market analysis.\n *\n * - generateTradingSignal - A function that generates trading signals and market analysis.\n * - GenerateTradingSignalInput - The input type for the generateTradingSignal function.\n * - GenerateTradingSignalOutput - The return type for the generateTradingSignal function.\n */\n\nimport {ai} from '@/ai/genkit';\nimport {z} from 'genkit';\nimport { getKlineData as fetchKlineData, getOrderBookData as fetchOrderBookData, getIndicatorData as fetchIndicatorData, getMarketData as fetchMarketData, analyzeOrderBook as anlyzeOrderBookUtil } from '@/lib/actions';\nimport { getRecentTrades as fetchRecentTradesData, KlineEntrySchema, OrderBookSchema, RecentTradeSchema, TickerInfoSchema, type OrderBook, type TickerInfo, type KlineEntry } from '@/lib/bybit-api';\nimport { IndicatorSettings, IndicatorDataSchema, type IndicatorData } from '@/lib/indicators';\n\n\nconst GenerateTradingSignalInputSchema = z.object({\n  symbol: z.string().describe('The trading symbol (e.g., BTCUSDT).'),\n  timeframe: z.string().describe('The timeframe for the chart and data (e.g., 1m, 5m, 1h, 1d).'),\n  indicatorSettings: IndicatorSettings.optional().describe('The settings for the technical indicators.'),\n});\nexport type GenerateTradingSignalInput = z.infer<typeof GenerateTradingSignalInputSchema>;\n\nconst GenerateTradingSignalOutputSchema = z.object({\n  currentPrice: z.number().describe('The current price of the asset.'),\n  entryPrice: z.number().describe('The recommended entry price for the trade.'),\n  takeProfit: z.number().describe('The recommended take-profit price level.'),\n  stopLoss: z.number().describe('The recommended stop-loss price level.'),\n  signal: z.enum(['Buy', 'Sell', 'Hold']).describe('The trading signal: Buy, Sell, or Hold.'),\n  reasoning: z.string().describe('Detailed reasoning for the generated signal, based on market analysis.'),\n  confidenceLevel: z.enum(['High', 'Medium', 'Low']).describe('The confidence level of the signal.'),\n});\nexport type GenerateTradingSignalOutput = z.infer<typeof GenerateTradingSignalOutputSchema>;\n\n// Tool Definitions\nconst getKlineData = ai.defineTool({ name: 'getKlineData', description: 'Get candlestick (Kline) data.', inputSchema: z.object({ symbol: z.string(), timeframe: z.string() }), outputSchema: z.array(KlineEntrySchema).nullable() }, fetchKlineData);\nconst getOrderBookData = ai.defineTool({ name: 'getOrderBookData', description: 'Get order book data.', inputSchema: z.object({ symbol: z.string() }), outputSchema: OrderBookSchema.nullable() }, fetchOrderBookData);\nconst getRecentTradesData = ai.defineTool({ name: 'getRecentTradesData', description: 'Get recent public trades.', inputSchema: z.object({ symbol: z.string() }), outputSchema: z.array(RecentTradeSchema) }, fetchRecentTradesData);\nconst getIndicatorData = ai.defineTool({ name: 'getIndicatorData', description: 'Get technical indicator data.', inputSchema: z.object({ symbol: z.string(), timeframe: z.string(), settings: IndicatorSettings.optional() }), outputSchema: IndicatorDataSchema.nullable() }, fetchIndicatorData);\nconst getMarketData = ai.defineTool({ name: 'getMarketData', description: 'Get the latest market ticker data.', inputSchema: z.object({ symbol: z.string() }), outputSchema: TickerInfoSchema.nullable() }, fetchMarketData);\nconst analyzeOrderBook = ai.defineTool({ name: 'analyzeOrderBook', description: 'Analyze order book to find support/resistance.', inputSchema: OrderBookSchema, outputSchema: z.object({ support: z.array(z.number()), resistance: z.array(z.number()) }) }, anlyzeOrderBookUtil);\n\nexport async function generateTradingSignal(input: z.infer<typeof GenerateTradingSignalInputSchema>): Promise<z.infer<typeof GenerateTradingSignalOutputSchema>> {\n  return generateTradingSignalFlow(input);\n}\n\nconst tradingSignalPrompt = ai.definePrompt({\n  name: 'tradingSignalPrompt',\n  output: { format: 'json', schema: GenerateTradingSignalOutputSchema },\n  tools: [getKlineData, getOrderBookData, getRecentTradesData, getIndicatorData, getMarketData, analyzeOrderBook],\n  system: `You are an expert financial analyst AI. Your goal is to generate a trading signal based on a comprehensive analysis of market data.\n\n  **Process:**\n  1.  **Get Current Price:** Start by calling \\`getMarketData\\` to get the current price. This is essential. If it fails, you cannot proceed.\n  2.  **Gather Data:** Call all other available data tools (\\`getKlineData\\`, \\`getOrderBookData\\`, \\`getRecentTradesData\\`, \\`getIndicatorData\\`) to build a complete picture of the market.\n  3.  **Analyze Order Book:** If \\`getOrderBookData\\` was successful, immediately pass its output to \\`analyzeOrderBook\\` to identify key support and resistance levels.\n  4.  **Synthesize Findings:** Review all the data you have gathered. Look for confirmations or divergences between different data sources (e.g., does the RSI confirm the price action? Does the order book support a potential breakout?).\n  5.  **Formulate Reasoning:** Construct a detailed, step-by-step \\`reasoning\\` for your final decision. Reference specific data points (e.g., \"RSI is 78, indicating overbought conditions,\" \"Strong resistance identified at $52,000 by order book analysis\"). If a tool failed, you MUST mention it in your reasoning (e.g., \"Could not retrieve indicator data, so confidence is lowered.\").\n  6.  **Generate Signal:** Based on your reasoning, determine the \\`signal\\` (Buy, Sell, or Hold), \\`entryPrice\\`, \\`takeProfit\\`, and \\`stopLoss\\`.\n  7.  **Set Confidence:** Determine the \\`confidenceLevel\\` based on how much data you could retrieve and how strongly it points to a particular outcome.\n\n  Your final output must be a valid JSON object matching the provided schema.`,\n});\n\nconst generateTradingSignalFlow = ai.defineFlow({ name: 'generateTradingSignalFlow', inputSchema: GenerateTradingSignalInputSchema, outputSchema: GenerateTradingSignalOutputSchema }, async (input) => {\n    const response = await tradingSignalPrompt({ prompt: `Generate a trading signal for ${input.symbol} on the ${input.timeframe} timeframe. Indicator settings: ${JSON.stringify(input.indicatorSettings || {})}` });\n    \n    if (!response.output) {\n      throw new Error(\"AI failed to produce a valid response.\");\n    }\n    const output = response.output;\n\n    // Final validation\n    if (output.currentPrice === null || isNaN(output.currentPrice) || output.currentPrice <= 0) {\n        throw new Error(\"AI failed to generate a valid signal with a positive current price.\");\n    }\n    \n    const requiredNumericFields: (keyof z.infer<typeof GenerateTradingSignalOutputSchema>)[] = ['entryPrice', 'takeProfit', 'stopLoss'];\n    for(const field of requiredNumericFields) {\n        if(output[field] === null || isNaN(output[field] as number) || (output[field] as number) <= 0) {\n            throw new Error(`AI generated an invalid or non-positive value for '${field}'.`);\n        }\n    }\n    \n    return output;\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 680, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/actions.ts"],"sourcesContent":["'use server';\n\nimport { generateTradingSignal, type GenerateTradingSignalOutput } from '@/ai/flows/generate-trading-signal';\nimport { getTicker, getOrderBook, getKline, type OrderBook, type TickerInfo, type KlineEntry } from '@/lib/bybit-api';\nimport { calculateIndicators, type IndicatorData, type IndicatorSettings, defaultIndicatorSettings } from '@/lib/indicators';\n\n/**\n * The response shape for the AI trading signal analysis.\n */\nexport type AiSignalResponse = GenerateTradingSignalOutput;\n\n/**\n * Server action to generate an AI-powered trading signal.\n * This function calls the Genkit flow and handles its response or errors.\n *\n * @param symbol - The trading symbol (e.g., 'BTCUSDT').\n * @param timeframe - The chart timeframe (e.g., '1h').\n * @param indicatorSettings - Optional custom settings for technical indicators.\n * @returns An object containing the success status, the analysis, and an optional error message.\n */\nexport async function getAiTradingSignal(symbol: string, timeframe: string, indicatorSettings?: IndicatorSettings): Promise<{ success: boolean, analysis?: AiSignalResponse, error?: string }> {\n  try {\n    const result = await generateTradingSignal({ symbol, timeframe, indicatorSettings });\n    return { success: true, analysis: result };\n  } catch (error) {\n    console.error('Error generating AI trading signal:', error);\n    const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred.';\n    return { success: false, error: errorMessage };\n  }\n}\n\n/**\n * Server action to get the latest market data (ticker info) for a symbol.\n *\n * @param symbol - The trading symbol.\n * @returns A promise that resolves to the TickerInfo object or null.\n */\nexport async function getMarketData(symbol: string): Promise<TickerInfo | null> {\n    return getTicker(symbol);\n}\n\n/**\n * Server action to get the order book for a symbol.\n *\n * @param symbol - The trading symbol.\n * @returns A promise that resolves to the OrderBook object or null.\n */\nexport async function getOrderBookData(symbol: string): Promise<OrderBook | null> {\n    return getOrderBook(symbol);\n}\n\n/**\n * Server action to get Kline (candlestick) data.\n *\n * @param symbol - The trading symbol.\n * @param interval - The timeframe interval (e.g., '1h', '4h').\n * @returns A promise that resolves to an array of Kline entries or null.\n */\nexport async function getKlineData(symbol: string, interval: string): Promise<KlineEntry[] | null> {\n    return getKline(symbol, interval);\n}\n\n/**\n * Server action to calculate a suite of technical indicators for a symbol and timeframe.\n *\n * @param symbol - The trading symbol.\n * @param timeframe - The chart timeframe.\n * @param settings - Optional custom indicator settings.\n * @returns A promise that resolves to the calculated IndicatorData object or null.\n */\nexport async function getIndicatorData(symbol: string, timeframe: string, settings: IndicatorSettings = defaultIndicatorSettings): Promise<IndicatorData | null> {\n    const klineData = await getKline(symbol, timeframe);\n    if (!klineData) return null;\n    const reversedKline = [...klineData].reverse();\n    const closePrices = reversedKline.map(k => parseFloat(k[4]));\n    const highPrices = reversedKline.map(k => parseFloat(k[2]));\n    const lowPrices = reversedKline.map(k => parseFloat(k[3]));\n    const volumes = reversedKline.map(k => parseFloat(k[5]));\n    return calculateIndicators(closePrices, highPrices, lowPrices, volumes, settings);\n}\n\n/**\n * Server action to analyze an order book and identify major support and resistance levels.\n *\n * @param orderBook - The OrderBook object to analyze.\n * @returns A promise resolving to an object with arrays of support and resistance price levels.\n */\nexport async function analyzeOrderBook(orderBook: OrderBook): Promise<{ support: number[]; resistance: number[] }> {\n  const bids = orderBook.bids.map(([price, size]) => ({ price: parseFloat(price), size: parseFloat(size) }));\n  const asks = orderBook.asks.map(([price, size]) => ({ price: parseFloat(price), size: parseFloat(size) }));\n\n  // Helper function to find the levels with the largest order sizes\n  const findLevels = (orders: { price: number; size: number }[], count: number) => {\n    const sorted = [...orders].sort((a, b) => b.size - a.size);\n    return sorted.slice(0, count).map(o => o.price);\n  };\n  \n  const supportLevels = findLevels(bids, 3);\n  const resistanceLevels = findLevels(asks, 3);\n\n  return {\n    support: supportLevels,\n    resistance: resistanceLevels,\n  };\n}\n\n/**\n * Represents the calculated volume pressure data.\n */\nexport interface VolumePressureData {\n    buyVolume: number;\n    sellVolume: number;\n    totalVolume: number;\n    buyPercentage: number;\n    sellPercentage: number;\n}\n"],"names":[],"mappings":";;;;;;;;;;AAEA;AACA;AACA;;;;;;;AAgBO,eAAe,mBAAmB,MAAc,EAAE,SAAiB,EAAE,iBAAqC;IAC/G,IAAI;QACF,MAAM,SAAS,MAAM,CAAA,GAAA,mJAAA,CAAA,wBAAqB,AAAD,EAAE;YAAE;YAAQ;YAAW;QAAkB;QAClF,OAAO;YAAE,SAAS;YAAM,UAAU;QAAO;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QACrD,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,OAAO;YAAE,SAAS;YAAO,OAAO;QAAa;IAC/C;AACF;AAQO,eAAe,cAAc,MAAc;IAC9C,OAAO,CAAA,GAAA,0HAAA,CAAA,YAAS,AAAD,EAAE;AACrB;AAQO,eAAe,iBAAiB,MAAc;IACjD,OAAO,CAAA,GAAA,0HAAA,CAAA,eAAY,AAAD,EAAE;AACxB;AASO,eAAe,aAAa,MAAc,EAAE,QAAgB;IAC/D,OAAO,CAAA,GAAA,0HAAA,CAAA,WAAQ,AAAD,EAAE,QAAQ;AAC5B;AAUO,eAAe,iBAAiB,MAAc,EAAE,SAAiB,EAAE,WAA8B,wHAAA,CAAA,2BAAwB;IAC5H,MAAM,YAAY,MAAM,CAAA,GAAA,0HAAA,CAAA,WAAQ,AAAD,EAAE,QAAQ;IACzC,IAAI,CAAC,WAAW,OAAO;IACvB,MAAM,gBAAgB;WAAI;KAAU,CAAC,OAAO;IAC5C,MAAM,cAAc,cAAc,GAAG,CAAC,CAAA,IAAK,WAAW,CAAC,CAAC,EAAE;IAC1D,MAAM,aAAa,cAAc,GAAG,CAAC,CAAA,IAAK,WAAW,CAAC,CAAC,EAAE;IACzD,MAAM,YAAY,cAAc,GAAG,CAAC,CAAA,IAAK,WAAW,CAAC,CAAC,EAAE;IACxD,MAAM,UAAU,cAAc,GAAG,CAAC,CAAA,IAAK,WAAW,CAAC,CAAC,EAAE;IACtD,OAAO,CAAA,GAAA,wHAAA,CAAA,sBAAmB,AAAD,EAAE,aAAa,YAAY,WAAW,SAAS;AAC5E;AAQO,eAAe,iBAAiB,SAAoB;IACzD,MAAM,OAAO,UAAU,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,KAAK,GAAK,CAAC;YAAE,OAAO,WAAW;YAAQ,MAAM,WAAW;QAAM,CAAC;IACxG,MAAM,OAAO,UAAU,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,KAAK,GAAK,CAAC;YAAE,OAAO,WAAW;YAAQ,MAAM,WAAW;QAAM,CAAC;IAExG,kEAAkE;IAClE,MAAM,aAAa,CAAC,QAA2C;QAC7D,MAAM,SAAS;eAAI;SAAO,CAAC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,IAAI,GAAG,EAAE,IAAI;QACzD,OAAO,OAAO,KAAK,CAAC,GAAG,OAAO,GAAG,CAAC,CAAA,IAAK,EAAE,KAAK;IAChD;IAEA,MAAM,gBAAgB,WAAW,MAAM;IACvC,MAAM,mBAAmB,WAAW,MAAM;IAE1C,OAAO;QACL,SAAS;QACT,YAAY;IACd;AACF;;;IApFsB;IAiBA;IAUA;IAWA;IAYA;IAiBA;;AAnEA,+OAAA;AAiBA,+OAAA;AAUA,+OAAA;AAWA,+OAAA;AAYA,+OAAA;AAiBA,+OAAA","debugId":null}},
    {"offset": {"line": 784, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getAiTradingSignal as '70c6125dbbad3595350503c517b30b35b439281e36'} from 'ACTIONS_MODULE0'\nexport {getIndicatorData as '70901addb4aa828fa13a5df1151b80af96986e9baf'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 839, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAoR,GACjT,kDACA","debugId":null}},
    {"offset": {"line": 853, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAgQ,GAC7R,8BACA","debugId":null}},
    {"offset": {"line": 867, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}