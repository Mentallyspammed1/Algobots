<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒŠ WhaleWave Titan Monitor (Linked)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=JetBrains+Mono:wght@400&display=swap');
        
        :root {
            --neon-green: #39FF14; --neon-red: #FF073A; --neon-blue: #00FFFF;
            --neon-purple: #BC13FE; --bg-dark: #050505; --panel: rgba(18, 18, 20, 0.9);
        }

        body { background-color: var(--bg-dark); color: #e2e8f0; font-family: 'JetBrains Mono', monospace; padding: 10px; overflow-x: hidden; }
        .orbitron { font-family: 'Orbitron', monospace; }

        .text-green-glow { color: var(--neon-green); text-shadow: 0 0 8px rgba(57, 255, 20, 0.5); }
        .text-red-glow { color: var(--neon-red); text-shadow: 0 0 8px rgba(255, 7, 58, 0.5); }
        .text-blue-glow { color: var(--neon-blue); text-shadow: 0 0 8px rgba(0, 255, 255, 0.5); }

        .glass-panel { background: var(--panel); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 0.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.5); padding: 15px; }

        .main-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 1024px) { .main-grid { grid-template-columns: 1fr 1fr 1fr; } }
        
        .indicator-box { background: #111; padding: 10px; border-radius: 5px; border-left: 3px solid var(--neon-purple); }
        .log-box { height: 300px; overflow-y: auto; font-size: 0.7rem; border: 1px solid #333; background: #000; padding: 5px; }
    </style>
</head>
<body onload="startMonitor()">

    <header class="flex justify-between items-center glass-panel px-6 py-3 mb-4">
        <div class="flex items-center gap-4">
            <div id="status-dot" class="w-3 h-3 rounded-full bg-red-500 transition-colors duration-500"></div>
            <div>
                <h1 class="text-xl font-bold orbitron tracking-wider text-white">WHALEWAVE<span style="color:var(--neon-purple)" class="ml-1">AI MONITOR</span></h1>
                <div class="text-[0.65rem] text-gray-400 font-mono"><span id="server-status">API: PULLING</span> | <span id="symbol">BTCUSDT</span></div>
            </div>
        </div>
        <div class="text-right">
            <div class="text-gray-500 text-xs">MARKET PRICE</div>
            <div id="ticker-price" class="text-2xl font-bold orbitron text-white">---</div>
        </div>
    </header>

    <main class="main-grid">
        
        <!-- LEFT: WSS & AI -->
        <section class="flex flex-col gap-4">
            <div class="glass-panel">
                <div class="text-lg font-bold text-purple-glow mb-2">DECISION ENGINE</div>
                <div class="flex justify-between items-center bg-gray-900 p-4 rounded">
                    <div>
                        <div class="text-sm text-gray-500">WSS SCORE</div>
                        <span id="wss-score" class="text-4xl font-black orbitron text-yellow-500">0.00</span>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-500">ACTION</div>
                        <div id="wss-action" class="text-3xl font-bold text-gray-400">HOLD</div>
                    </div>
                </div>
                <div id="signal-reason" class="bg-black/50 p-2 rounded text-xs text-yellow-400 mt-3">
                    Awaiting first AI analysis...
                </div>
            </div>

            <div class="glass-panel">
                <div class="text-lg font-bold text-green-glow mb-2">ACCOUNT & POSITION</div>
                <div class="flex justify-between text-sm font-mono my-1">
                    <span>Balance: <span id="acc-balance" class="text-green-500">$1000.00</span></span>
                    <span>Daily PnL: <span id="acc-pnl" class="text-gray-400">$0.00</span></span>
                </div>
                <div id="pos-display" class="mt-4 p-2 rounded hidden">
                    <div class="text-xs font-bold mb-1"><span id="pos-side-label"></span></div>
                    <div class="flex justify-between text-xs font-mono">
                        <span>PNL: <span id="pos-pnl" class="text-white">$0.00</span></span>
                        <span>ENTRY: <span id="pos-entry" class="text-white"></span></span>
                        <span>SL: <span id="pos-sl" class="text-red-300"></span></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- CENTER: Indicators -->
        <section class="flex flex-col gap-4">
            <div class="glass-panel">
                <div class="text-lg font-bold text-blue-glow mb-2">TECHNICAL MATRIX</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="indicator-box"><span class="text-xs text-gray-400 block">RSI (10)</span><span id="ind-rsi" class="text-lg text-white">--</span></div>
                    <div class="indicator-box"><span class="text-xs text-gray-400 block">STOCH K (3)</span><span id="ind-stoch" class="text-lg text-white">--</span></div>
                    <div class="indicator-box"><span class="text-xs text-gray-400 block">ADX (14)</span><span id="ind-adx" class="text-lg text-white">--</span></div>
                    <div class="indicator-box"><span class="text-xs text-gray-400 block">CHOP (14)</span><span id="ind-chop" class="text-lg text-white">--</span></div>
                    <div class="indicator-box"><span class="text-xs text-gray-400 block">FVG Status</span><span id="ind-fvg" class="text-lg text-white">--</span></div>
                    <div class="indicator-box"><span class="text-xs text-gray-400 block">MTF Trend</span><span id="ind-trend" class="text-lg text-white">--</span></div>
                </div>
            </div>
        </section>

        <!-- RIGHT: Log -->
        <section>
            <div class="glass-panel">
                <h3 class="text-lg font-bold text-blue-glow mb-2">LIVE SYSTEM LOG</h3>
                <div id="app-logs" class="log-box"></div>
            </div>
        </section>
    </main>

    <script>
        const API_URL = '/api/dashboard';
        const PULL_INTERVAL = 1000;

        const UI = {
            dot: document.getElementById('status-dot'), ticker: document.getElementById('ticker-price'), wssScore: document.getElementById('wss-score'), wssAction: document.getElementById('wss-action'), signalReason: document.getElementById('signal-reason'), accBalance: document.getElementById('acc-balance'), accPnl: document.getElementById('acc-pnl'), posDisplay: document.getElementById('pos-display'), posSideLabel: document.getElementById('pos-side-label'), posPnl: document.getElementById('pos-pnl'), posEntry: document.getElementById('pos-entry'), posSl: document.getElementById('pos-sl'), log: document.getElementById('app-logs'), indRsi: document.getElementById('ind-rsi'), indStoch: document.getElementById('ind-stoch'), indAdx: document.getElementById('ind-adx'), indChop: document.getElementById('ind-chop'), indFvg: document.getElementById('ind-fvg'), indTrend: document.getElementById('ind-trend'), lastPrice: 0,

            logMsg: (msg, type = 'info') => {
                const con = document.getElementById('app-logs');
                const time = new Date().toLocaleTimeString().slice(0, -3);
                const color = type === 'BUY' ? 'text-green-400' : type === 'SELL' ? 'text-red-400' : 'text-gray-400';
                const row = document.createElement('div');
                row.className = color;
                row.innerHTML = `<span style="color:#555">[${time}]</span> ${msg}`;
                con.prepend(row);
                if(con.children.length > 50) con.lastChild.remove();
            },
            
            colorize: (val, type) => {
                const v = parseFloat(val);
                if (type === 'price' && v > UI.lastPrice) return `<span class="text-green-glow">${val}</span>`;
                if (type === 'price' && v < UI.lastPrice) return `<span class="text-red-glow">${val}</span>`;
                if (type === 'pnl') {
                    if (v > 0) return `<span class="text-green-glow">$${val}</span>`;
                    if (v < 0) return `<span class="text-red-glow">$${val}</span>`;
                    return `$${val}`;
                }
                if (type === 'wss') {
                    if (v >= 2.0) return `<span class="text-green-glow">${val}</span>`;
                    if (v <= -2.0) return `<span class="text-red-glow">${val}</span>`;
                    return `<span style="color:var(--neon-yellow)">${val}</span>`;
                }
                if (type === 'indicator') {
                    if (val.includes('BULLISH')) return `<span class="text-green-glow">${val}</span>`;
                    if (val.includes('BEARISH')) return `<span class="text-red-glow">${val}</span>`;
                    return val;
                }
                return val;
            }
        };

        async function fetchDashboardData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('API not available (500)');
                const data = await response.json();
                
                if (Object.keys(data).length === 0) {
                    UI.dot.style.backgroundColor = 'var(--neon-purple)';
                    return;
                }

                // 1. Status
                UI.dot.style.backgroundColor = 'var(--neon-green)';
                
                // 2. Price
                UI.ticker.innerHTML = UI.colorize(data.price, 'price');
                UI.lastPrice = data.price;
                
                // 3. WSS & Signal
                UI.wssScore.innerHTML = UI.colorize(data.wss, 'wss');
                UI.wssAction.textContent = data.wss_action;
                UI.wssAction.style.color = data.wss_action === 'BUY' ? 'var(--neon-green)' : data.wss_action === 'SELL' ? 'var(--neon-red)' : '#777';
                UI.signalReason.textContent = data.ai_reason;
                
                // 4. Account
                UI.accBalance.innerHTML = UI.colorize(data.acc_balance, 'pnl');
                UI.accPnl.innerHTML = UI.colorize(data.daily_pnl, 'pnl');

                // 5. Position
                if (data.pos_active) {
                    const side = data.pos_side;
                    const pnlCol = data.pos_pnl >= 0 ? 'bg-green-900/50' : 'bg-red-900/50';
                    UI.posDisplay.className = `mt-4 p-2 rounded ${pnlCol}`;
                    UI.posSideLabel.textContent = `OPEN ${side}`;
                    UI.posSideLabel.style.color = side === 'BUY' ? 'var(--neon-green)' : 'var(--neon-red)';
                    UI.posPnl.innerHTML = UI.colorize(data.pos_pnl, 'pnl');
                    UI.posEntry.textContent = data.pos_entry;
                    UI.posSl.textContent = data.pos_sl;
                    
                } else {
                    UI.posDisplay.classList.add('hidden');
                }
                
                // 6. Indicators
                UI.indRsi.innerHTML = UI.colorize(data.indicators.rsi, 'indicator');
                UI.indStoch.innerHTML = UI.colorize(data.indicators.stoch_k, 'indicator');
                UI.indAdx.innerHTML = UI.colorize(data.indicators.adx, 'indicator');
                UI.indChop.innerHTML = UI.colorize(data.indicators.chop, 'indicator');
                UI.indFvg.innerHTML = UI.colorize(data.indicators.fvg, 'indicator');
                UI.indTrend.innerHTML = UI.colorize(data.indicators.trend_mtf, 'indicator');

                
            } catch (error) {
                UI.dot.style.backgroundColor = 'var(--neon-red)';
                UI.logMsg(`Monitor Error: ${error.message}`, 'error');
            }
        }

        function startMonitor() {
            // Initial fetch
            fetchDashboardData(); 
            // Start pulling data periodically
            setInterval(fetchDashboardData, PULL_INTERVAL);
        }
    </script>
</body>
</html>
