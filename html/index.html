<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algobots Project Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #0056b3;
        }
        nav ul {
            list-style: none;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }
        nav ul li a {
            text-decoration: none;
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        nav ul li a:hover {
            background-color: #0056b3;
        }
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .section h2 {
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .placeholder {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Algobots Project Dashboard</h1>
        <p>Welcome to the unified dashboard for the Algobots project. This page provides a central overview and navigation to various components and documentation.</p>

        <nav>
            <h2>Documentation & Guides</h2>
            <ul>
                <li><a href="merged_html_output.html">Consolidated Documentation</a></li>
                <li><a href="bbapi.html">Bybit API Overview</a></li>
                <li><a href="backtester.html">Backtesting Framework</a></li>
                <li><a href="strategy.html">Trading Strategies</a></li>
                <li><a href="indicators.html">Technical Indicators</a></li>
                <li><a href="config.html">Configuration Guide</a></li>
                <li><a href="main.html">Main Execution Flow</a></li>
                <li><a href="marketmake.html">Market Maker Bot</a></li>
                <li><a href="pybit.html">Pybit Library Usage</a></li>
                <li><a href="PSG.html">PSG Bot Details</a></li>
                <li><a href="README.html">Project README</a></li>
                <!-- Add more links as needed -->
            </ul>
        </nav>

        <div class="section">
            <h2>Bot Status & Metrics</h2>
            <div id="bot-status-content">
                <p><strong>Bot Status:</strong> <span id="bot-status">Loading...</span></p>
                <p><strong>Current Price:</strong> <span id="current-price">Loading...</span></p>
                <p><strong>Last Signal:</strong> <span id="last-signal">Loading...</span></p>
                <p><strong>Signal Score:</strong> <span id="signal-score">Loading...</span></p>
                <p><strong>Total PnL:</strong> <span id="total-pnl">Loading...</span></p>
                <p><strong>Win Rate:</strong> <span id="win-rate">Loading...</span></p>
                <p><strong>Total Trades:</strong> <span id="total-trades">Loading...</span></p>
                <h3>Open Positions:</h3>
                <ul id="open-positions-list"><li>Loading...</li></ul>
            </div>
        </div>

        <div class="section">
            <h2>Backtest Results</h2>
            <p class="placeholder">Overview of recent backtest performance, equity curves, and strategy comparisons.</p>
            <!-- Dynamic content will be loaded here -->
        </div>

        <div class="section">
            <h2>Recent Activity & Logs</h2>
            <p class="placeholder">Summary of recent trades, system events, and links to detailed log files.</p>
            <!-- Dynamic content will be loaded here -->
        </div>

    </div>

    <script>
        const API_BASE_URL = "http://127.0.0.1:8000"; // Assuming backend_app.py runs on port 8000

        async function fetchBotStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/bot_status`);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                
                document.getElementById("bot-status").textContent = data.config_summary.use_pybit ? "Running (Live)" : "Running (Simulated)";
                document.getElementById("current-price").textContent = data.current_price;
                document.getElementById("last-signal").textContent = data.last_signal;
                document.getElementById("signal-score").textContent = data.last_signal_score.toFixed(2);
                document.getElementById("total-pnl").textContent = data.performance_summary.total_pnl;
                document.getElementById("win-rate").textContent = data.performance_summary.win_rate;
                document.getElementById("total-trades").textContent = data.performance_summary.total_trades;

                const openPositionsList = document.getElementById("open-positions-list");
                openPositionsList.innerHTML = "";
                if (data.open_positions.length > 0) {
                    data.open_positions.forEach(pos => {
                        const listItem = document.createElement("li");
                        listItem.textContent = `Symbol: ${pos.symbol}, Side: ${pos.side}, Qty: ${pos.qty}, Entry Price: ${pos.entry_price}`;
                        openPositionsList.appendChild(listItem);
                    });
                } else {
                    const listItem = document.createElement("li");
                    listItem.textContent = "No open positions.";
                    openPositionsList.appendChild(listItem);
                }

            } catch (error) {
                console.error("Error fetching bot status:", error);
                document.getElementById("bot-status-content").innerHTML = `<p style="color: red;">Error loading bot status: ${error.message}. Is the bot running and backend_app.py active?</p>`;
            }
        }

        // Fetch status every 5 seconds
        setInterval(fetchBotStatus, 5000);

        // Initial fetch on page load
        fetchBotStatus();
    </script>
</body>
</html>